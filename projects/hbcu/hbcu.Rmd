---
title: "HBCU"
author: "Afton Coombs"
date: "2/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
```

## Load data

```{r load-data}
## Copied from 
## https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-02-02/readme.md

# Get the Data

# Read in with tidytuesdayR package 
# Install from CRAN via: install.packages("tidytuesdayR")
# This loads the readme and all the datasets for the week of interest

# Either ISO-8601 date or year/week works!

tuesdata <- tidytuesdayR::tt_load('2021-02-02')
tuesdata <- tidytuesdayR::tt_load(2021, week = 6)

hbcu_all <- tuesdata$hbcu_all
```

```{r clean-data}
## Also copied from 
## https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-02-02/readme.md

## Example cleaning script
hbcu_all <-
  hbcu_all %>%
  janitor::clean_names()


### Clean data ----------------------------------------------------------------
# We can separate by gender OR by program length and public/private, not both

### Gender breakdown
hbcu_by_gender <- 
  hbcu_all %>%
  # We only need year and gender columns
  dplyr::select(year, males, females) %>%
  # Convert to tidy format, collapsing male/female into one descriptor field
  tidyr::pivot_longer(males:females,
                      names_to = "gender",
                      values_to = "students") %>%
  # Convert from plural to singular for cleaner data
  # "s%" specifies an s character at the end of a string
  # ("$" is end of string in regular expressions)
  dplyr::mutate(gender = stringr::str_remove(gender, "s$"))


### Program breakdown
hbcu_by_program <- 
  hbcu_all %>%
  # We need fields with "public" or "private" in the name
  # (They also have 2- vs 4-year)
  # We DON'T need fields with "total" in the name, since this is redundant
  dplyr::select(year,
                dplyr::contains(c("public", "private")),
                -dplyr::contains("total")) %>%
  # names_pattern argument does the heavy lifting
  # It separates names into groups, as specified by parentheses "(group)"
  # Field names are structured so that program length is followed by public/private
  # We also specift "x_" as an optional argument using regular expressions
  tidyr::pivot_longer(cols = x4_year_public:x2_year_private,
                      names_pattern = "[x_]?(.*)_(.*)",
                      names_to = c("program_length", "public_private"),
                      values_to = "students") %>%
  dplyr::mutate(program_length = 
                  paste(readr::parse_number(program_length), "years"))
```
